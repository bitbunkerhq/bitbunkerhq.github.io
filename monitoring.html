<!-- ===== MONITORING OVERVIEW ===== -->
<section id="monitoring" class="monitoring-section">
  <div class="container">
    <h2>Monitoring en Acción</h2>
    <p class="intro">
      Observabilidad de <strong>PostgreSQL</strong> con <strong>Prometheus + Grafana</strong>. 
      Aquí contamos la historia de la <em>última prueba relevante</em> (baseline → carga → resultados), 
      y al final listamos todos los casos anteriores.
    </p>

    <!-- 1) ANTES -->
    <div class="monitoring-block">
      <h3>1. Situación inicial</h3>
      <p>
        Entorno estable y de baja actividad para establecer un baseline: conexiones mínimas a la base 
        y a la instancia, TPS plano, ausencia de deadlocks. Esto nos da un punto de comparación para los cambios.
      </p>
      <figure>
        <img src="images/2025-08/loadtest-v1/01-before-kpis.png" alt="KPIs iniciales: conexiones, TPS, cache hit">
        <figcaption>Baseline: métricas planas y cache hit &gt; 99%.</figcaption>
      </figure>
      <details>
        <summary>Ver más gráficos de la etapa inicial</summary>
        <figure>
          <img src="images/2025-08/loadtest-v1/06-filas-leidas.png" alt="Actividad de filas (read/change)">
          <figcaption>Flujo constante de filas leídas (Returned) en reposo, sin operaciones de inserción, actualización o borrado. Esto confirma que la base estaba recibiendo únicamente consultas de lectura durante la línea base.</figcaption>
        </figure>
        <figure>
          <img src="images/2025-08/loadtest-v1/05-conexiones-por-estado.png" alt="Conexiones por estado">
          <figcaption>Durante la línea base no se registraron conexiones activas ni en espera. La base permaneció sin actividad de usuarios o procesos externos, ideal para medir un estado “en reposo” antes de iniciar las pruebas de carga.</figcaption>
        </figure>
      </details>
    </div>

    <!-- 2) DURANTE -->
    <div class="monitoring-block">
      <h3>2. Pruebas de carga</h3>
      <p>
        Ejecutamos <strong>pgbench</strong> y consultas BI intensivas para simular concurrencia real. 
        Observamos comportamiento bajo presión: latencias, locks, variaciones de TPS y cache hit.
      </p>
      <figure>
        <img src="images/2025-08/loadtest-v1/02-during-tps.png" alt="TPS durante las pruebas">
        <figcaption>Durante la prueba de carga simultánea, el servidor PostgreSQL alcanzó 49 conexiones activas y 2 transacciones abiertas de forma concurrente.
El pico de rendimiento se registró en 1.15K transacciones por segundo (TPS), con un alto volumen de filas leídas, insertadas y actualizadas en tiempo real.
Este panel muestra el impacto global de la carga sobre conexiones, actividad de consultas y movimiento de datos.</figcaption>
      </figure>
      <details>
        <summary>Ver más gráficos de la prueba</summary>
        <figure>
          <img src="images/2025-08/loadtest-v1/03-peak-health.png" alt="Latencia">
          <figcaption>Durante todo el ensayo no se produjeron deadlocks.
Los locks por modo se mantuvieron en niveles controlados, indicando que la concurrencia fue gestionada correctamente por PostgreSQL sin bloqueos críticos que interrumpieran la ejecución de las consultas.</figcaption>
        </figure>
        <figure>
          <img src="images/2025-08/loadtest-v1/07-resources-during.png" alt="Locks">
          <figcaption>El incremento de actividad elevó el uso de CPU hasta un 0,75% y la memoria RAM hasta un 9,15%.
Estos valores muestran que la infraestructura tenía capacidad de sobra para absorber la carga aplicada, sin comprometer la estabilidad del sistema.</figcaption>
        </figure>
      </details>
    </div>

    <!-- 3) DESPUÉS -->
    <div class="monitoring-block">
<h3>3. Resultados y balance</h3>

<p>
Tras dos pruebas de carga independientes, el sistema demostró su capacidad para absorber picos de concurrencia y actividad sin degradación sostenida.
</p>

<p>
El gráfico muestra cómo, al finalizar cada ciclo de carga, las métricas clave —conexiones, TPS, actividad de filas, locks y deadlocks— retornan rápidamente a valores normales.
</p>

<p>
Este comportamiento confirma un <strong>baseline estable post-prueba</strong>, validando tanto la configuración de PostgreSQL como la capacidad del entorno para manejar cargas intermitentes sin impacto residual.
</p>

<br>

<p>
La ejecución de las pruebas de carga permitió validar el comportamiento del servidor PostgreSQL bajo un escenario de concurrencia moderada y consultas de alta frecuencia.
</p>

<h4>Estabilidad del sistema:</h4>
<p>
No se detectaron errores críticos ni caídas durante las pruebas. Todos los procesos se ejecutaron y finalizaron de forma ordenada, sin comprometer la disponibilidad de la base de datos.
</p>

<h4>Concurrencia gestionada:</h4>
<p>
El motor PostgreSQL manejó correctamente las 49 conexiones activas simultáneas y las operaciones concurrentes, manteniendo la latencia en valores bajos.
</p>

<h4>Rendimiento:</h4>
<p>
Se alcanzó un pico de 1.15K transacciones por segundo (TPS), con un flujo constante de inserciones, actualizaciones y lecturas en grandes volúmenes de filas.
</p>

<h4>Integridad y ausencia de bloqueos graves:</h4>
<p>
Los locks observados durante la ejecución se mantuvieron dentro de valores esperados para este tipo de pruebas, y no se registraron deadlocks.
</p>

<h4>Recursos del sistema:</h4>
<p>
El consumo de CPU y memoria mostró un aumento controlado, confirmando que el hardware actual dispone de margen para cargas más exigentes.
</p>

<h4>Conclusión:</h4>
<p>
El entorno demostró una capacidad óptima para absorber picos de actividad sin degradar el servicio, lo que indica que la configuración actual es adecuada para escenarios de uso real y que existe espacio para escalar la carga en futuros ensayos.
</p>

<figure>
  <img src="images/2025-08/loadtest-v1/08-final-reposo.png" alt="Dashboard tras pruebas de carga">
  <figcaption>Visión global de métricas tras las pruebas de carga: recuperación estable y sin impacto residual.</figcaption>
</figure>

      </details>
    </div>

    <!-- LISTA DE TODOS LOS CASOS
    <section id="experiments" class="experiments-list">
      <h3>Todas las pruebas</h3>
      <ul>
        <li><a href="/experiments/loadtest-v1.html">Load Test V1 (2025-08-12) — pgbench 32c/8j, 5m</a></li>
        <li><a href="/experiments/bi-queries-v1.html">BI Queries V1 (2025-08-10) — Top productos/mes</a></li>
      </ul>
    </section>
     -->
  </div>
</section>

<style>
  .monitoring-section { background:#0b1e3a; color:#e6edf3; padding:60px 20px; }
  .monitoring-section .container { max-width:1100px; margin:0 auto; }
  .monitoring-section h2 { font-size:2.2rem; margin-bottom:20px; border-bottom:2px solid rgba(255,255,255,0.1); padding-bottom:10px; }
  .monitoring-section .intro { font-size:1.08rem; color:#b8c5d3; margin-bottom:36px; }
  .monitoring-block { margin-bottom:50px; }
  .monitoring-block h3 { font-size:1.35rem; color:#5ac8fa; margin-bottom:10px; }
  .monitoring-block p { color:#c8d6e5; line-height:1.55; margin-bottom:16px; }
  .monitoring-block figure { margin:0 0 12px 0; }
  .monitoring-block img { width:100%; border-radius:10px; border:1px solid rgba(255,255,255,0.12); box-shadow:0 2px 10px rgba(0,0,0,0.35); }
  .monitoring-block figcaption { font-size:.92rem; color:#a8b9c9; margin-top:6px; }
  .experiments-list h3 { margin-top:40px; }
  .experiments-list ul { list-style:none; padding:0; margin:14px 0 0 0; }
  .experiments-list li { margin:8px 0; }
  .experiments-list a { color:#e6edf3; text-decoration:underline; text-underline-offset:3px; }
  .experiments-list a:hover { opacity:.9; }
  details { margin-top:10px; border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:10px 12px; }
  summary { cursor:pointer; color:#d9e3ee; }
</style>
